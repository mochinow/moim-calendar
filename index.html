<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ëª¨ì„ ì¼ì • ì•ˆë‚´</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial; padding: 16px; max-width: 820px; margin: 0 auto; }
    h1 { margin: 8px 0 14px; }
    .card { border: 1px solid #e6e6e6; border-radius: 12px; padding: 14px; margin: 12px 0; }
    .muted { color: #666; font-size: 14px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    input[type="date"] { padding: 10px; border-radius: 10px; border: 1px solid #ddd; }
    a { word-break: break-all; }
    .badge { display:inline-block; padding: 2px 8px; border-radius: 999px; border:1px solid #ddd; font-size: 12px; }
    .list { margin: 8px 0 0; padding: 0; list-style: none; }
    .list li { padding: 10px 0; border-top: 1px solid #f0f0f0; }
    .list li:first-child { border-top: none; }
  </style>
</head>
<body>
  <h1 id="title">ëª¨ì„ ì¼ì • ì•ˆë‚´</h1>
  <div class="muted">ë§í¬ í•˜ë‚˜ë¡œ ì¼ì •/ì¥ì†Œ/ì…ì¥/ì£¼ì°¨ ì•ˆë‚´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>

  <div class="card">
    <div class="row">
      <div><span class="badge">ë‚ ì§œ ì„ íƒ</span></div>
      <input id="datePicker" type="date" />
      <div class="muted" id="nextHint"></div>
    </div>
    <div style="margin-top:10px" id="selectedEvent"></div>

    <div style="margin-top:14px">
      <div class="muted">ë‹¤ê°€ì˜¤ëŠ” ì¼ì •</div>
      <ul class="list" id="eventList"></ul>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px">ğŸ“ ì¥ì†Œ ì •ë³´</h2>
    <div id="place"></div>
    <div style="margin-top:10px" class="muted">ì§€ë„ ë§í¬</div>
    <div><a id="mapLink" href="#" target="_blank" rel="noreferrer">ì§€ë„ ì—´ê¸°</a></div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px">ğŸšª ì…ì¥ ë°©ë²•</h2>
    <div id="entryGuide"></div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px">ğŸ…¿ï¸ ì£¼ì°¨ ì •ë³´</h2>
    <div id="parkingInfo"></div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 10px">ğŸ“ ê³µí†µ ì•ˆë‚´</h2>
    <div id="commonNotes"></div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  function todayYMD() {
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth()+1).padStart(2,'0');
    const dd = String(now.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }

  function sortEvents(events) {
    return events.slice().sort((a,b) => a.date.localeCompare(b.date));
  }

  function findNextEvent(events) {
    const t = todayYMD();
    return sortEvents(events).find(e => e.date >= t) || sortEvents(events)[0] || null;
  }

  function renderSelected(event) {
    if (!event) {
      $("selectedEvent").innerHTML = `<div class="muted">ì„ íƒí•œ ë‚ ì§œì— ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }
    const memo = event.memo ? `<div class="muted" style="margin-top:6px">ë©”ëª¨: ${event.memo}</div>` : "";
    $("selectedEvent").innerHTML = `
      <div><strong>${event.date}</strong></div>
      <div>ì‹œê°„: ${event.startTime} ~ ${event.endTime}</div>
      ${memo}
    `;
  }

  function renderList(events) {
    const list = $("eventList");
    list.innerHTML = "";
    sortEvents(events).forEach(e => {
      const li = document.createElement("li");
      li.innerHTML = `<div><strong>${e.date}</strong> <span class="muted">(${e.startTime}~${e.endTime})</span></div>` + (e.memo ? `<div class="muted">${e.memo}</div>` : "");
      li.style.cursor = "pointer";
      li.onclick = () => {
        $("datePicker").value = e.date;
        renderSelected(e);
      };
      list.appendChild(li);
    });
  }

  async function main() {
    const [cfgRes, evRes] = await Promise.all([
      fetch("./data/siteConfig.json", { cache: "no-store" }),
      fetch("./data/events.json", { cache: "no-store" })
    ]);
    const cfg = await cfgRes.json();
    const events = await evRes.json();

    $("title").textContent = cfg.title || "ëª¨ì„ ì¼ì • ì•ˆë‚´";
    $("place").innerHTML = `
      <div><strong>${cfg.locationName || ""}</strong></div>
      <div class="muted">${cfg.address || ""}</div>
    `;
    $("mapLink").href = cfg.mapLink || "#";
    $("entryGuide").textContent = cfg.entryGuide || "";
    $("parkingInfo").textContent = cfg.parkingInfo || "";
    $("commonNotes").textContent = cfg.commonNotes || "";

    renderList(events);

    const next = findNextEvent(events);
    if (next) {
      $("datePicker").value = next.date;
      $("nextHint").textContent = `ê¸°ë³¸ ì„ íƒ: ê°€ì¥ ê°€ê¹Œìš´ ì¼ì • (${next.date})`;
      renderSelected(next);
    } else {
      $("nextHint").textContent = "ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.";
      renderSelected(null);
    }

    $("datePicker").addEventListener("change", (e) => {
      const d = e.target.value;
      const found = events.find(x => x.date === d);
      renderSelected(found || null);
    });
  }

  main().catch(err => {
    document.body.innerHTML = "<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. data í´ë”/íŒŒì¼ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>";
    console.error(err);
  });
</script>
</body>
</html>
